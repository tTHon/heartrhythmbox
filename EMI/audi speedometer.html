<!DOCTYPE html>
<html>

<body>

<div id="demo"></div>
<div style="text-align:center">
  <canvas id="canvas" style="background-color: #333;"></canvas>
</div>



<script>
var canvas = document.getElementById("canvas");
var ctx = canvas.getContext("2d");
var vw = Math.round(window.innerWidth/100);
var vh = Math.round(window.innerHeight/100);
var nav=0; 
baseX=25*vw;baseY=70*vh;
widthU = 4*vw;baseWidth=17*widthU;
xTF=0.95;yTF=0.31;
colorArray = ['red','orange','yellow','green']

createCanvas()
drawAxis()
var testArray = draw (0,0.3*vw,'#f1f1f1')
//boxDraw(testArray,3.5)


window.addEventListener("keydown", function(event) {
    event.preventDefault();
    if (event.keyCode===32) {
      moveFwd(0,3.9)
      }
})


function moveFwd(from,to){
  var cls=from;
  xyArray = draw (cls,0.3*vw,'#333333')
  var moveInterval = setInterval(function(){
    //clearDraw (xyArray,cls)
    //boxDraw(xyArray,cls)
    drawAxis()

    drawInner(cls,0.3*vw+0.5)
    cls=cls+0.01;
    xyArray= draw (cls,0.3*vw,'#f1f1f1')
    if (cls>=to){
      clearInterval(moveInterval)
    }
  },0)

}

function draw(cls,width,color){
  ctx.beginPath();
  ctx.lineWidth = Math.round(width)+0.5;
  ctx.strokeStyle = color;
  baseLeft = Math.round(baseX-((1+cls)*widthU));baseRight = Math.round(baseX+(widthU*(cls*3)))
  thisWidth = Math.round(baseRight-baseLeft);
  radius = Math.round(0.02*thisWidth);
  x1 = Math.round(baseX-(0.5*(widthU)));y1=Math.round(baseY-(yTF*(cls+0.5)*widthU))
  ctx.moveTo(x1,y1)
  x2 = Math.round(baseLeft+(xTF*thisWidth)-radius-0.1*vw);y2=Math.round(baseY-(yTF*thisWidth));
  ctx.lineTo(x2,y2)
  x3=Math.round(baseLeft+(xTF*thisWidth));y3=Math.round(baseY-(yTF*thisWidth));
  x4=Math.round(baseLeft+(xTF*thisWidth));y4=Math.round(baseY-(yTF*thisWidth)+radius);
  ctx.arcTo(x3,y3,x4,y4,radius)
  x5=Math.round(baseLeft+thisWidth);y5=Math.round(baseY);
  ctx.lineTo(x5,y5)
  ctx.stroke()
  drawAxis()
  var xyArray = [x1,y1,x2,y2,x3,y3,x4,y4,x5,y5,radius];
  return xyArray;
}

function drawInner(cls,width){
  ctx.beginPath();
  ctx.lineWidth = Math.round(width)+0.5;
  colorMark = Math.floor(cls)
  ctx.strokeStyle = colorArray[colorMark];
  baseLeft = Math.round(baseX-((1+cls)*widthU));baseRight = Math.round(baseX+(widthU*(cls*3)))
  thisWidth = Math.round(baseRight-baseLeft);
  radius = Math.round(0.02*thisWidth);
  x1 = Math.round(baseX);y1=Math.round(baseY-(yTF*(cls+1)*widthU))
  ctx.moveTo(x1,y1)

  //shade the line
  shade = (cls-colorMark)


  //cont at curve
  if (x2<baseX){x2=baseX}
  x2 = Math.round(baseLeft+(xTF*thisWidth)-radius-0.1*vw);y2=Math.round(baseY-(yTF*thisWidth));
  ctx.lineTo(x2,y2)
  x3=Math.round(baseLeft+(xTF*thisWidth));y3=Math.round(baseY-(yTF*thisWidth));
  x4=Math.round(baseLeft+(xTF*thisWidth));y4=Math.round(baseY-(yTF*thisWidth)+radius);
  ctx.arcTo(x3,y3,x4,y4,radius)
  x5=Math.round(baseLeft+thisWidth);y5=Math.round(baseY);
  ctx.lineTo(x5,y5)
  ctx.stroke()

  //clearHandle
  ctx.lineWidth = Math.round(width)+1.5;
  a1 = Math.round(baseX-(0.6*(widthU)));b1=Math.round(baseY-(yTF*(cls)*widthU))
  ctx.beginPath();
  ctx.moveTo (a1,b1);ctx.lineTo(x1,y1);ctx.lineTo(baseX,baseY)
  ctx.strokeStyle = '#333'
  ctx.stroke();
  drawAxis()
}

function boxDraw(xyArray,cls){

  var iCls=cls;
  if (cls<0.05){iCls=0.05}
  for (var i=0;i<iCls;i=i+0.05){
  //line the rightmost 
  bLeft = baseX-((1+i)*widthU);bRight = baseX+(widthU*(i*3))
  thisWidth = bRight-bLeft;
  document.getElementById('demo').innerHTML = thisWidth;
 
  //find the nearest mark
  a1=baseX+(i*3*widthU);b1=baseY;
  a2=(a1*xTF);b2=baseY-(yTF*thisWidth);
  a4=(baseX+((i-0.01)*3*widthU));b4=baseY;
  a3=(a4*xTF);b3=baseY-(yTF*(thisWidth-0.01));  
  color = getColor(i)
  ctx.beginPath;
  ctx.moveTo(a1,b1);ctx.lineTo(a2,b2);
  ctx.lineTo(a3,b3);ctx.lineTo(a4,b4);
  ctx.closePath();
  ctx.fillStyle = color;
  ctx.fill(); 

  }

  //last point
  //line the rightmost 
  baseLeft = Math.round(baseX-((1+cls)*widthU));baseRight = Math.round(baseX+(widthU*(cls*3)))
  lastWidth = Math.round(baseRight-baseLeft);
  radius = Math.round(0.02*lastWidth);
  x4=baseRight;y4=baseY;
  x3=x4-((1-xTF)*lastWidth);y3=y4-(yTF*lastWidth);
 
  //find the nearest mark
  //var colorMark = Math.floor(cls);
  //var shade = Math.floor((cls % 1)*10)/10;
  //colorBlk = colorMark + shade;

  x1=baseX+((cls-0.05)*3*widthU);y1=baseY;
  x2=x1-((1-xTF)*thisWidth);y2=y1-(x1-baseLeft)*yTF;
  if (x1<baseX){x1=baseX};if (x2<baseX){x2=baseX}
  if (x4<baseX){x4=baseX};if (x3<baseX){x3=baseX}
  curveX3=xyArray[4];curveY3=xyArray[5];
  curveX4=xyArray[6];curveY4=xyArray[7];
  color = getColor(cls)
  ctx.beginPath;
  ctx.moveTo(x1,y1);ctx.lineTo(x2,y2);ctx.lineTo(x3-radius,y3);
  ctx.arcTo(x3,y3,x4,y4+radius,radius)
  ctx.lineTo(x4,y4);
  ctx.closePath();
  ctx.fillStyle = color;
  ctx.fill(); 
  drawAxis();
}



function clearDraw(xyArray,cls){

  ctx.lineWidth = Math.round(0.3*vw)+1.5;
  ctx.strokeStyle = '#333';ctx.fillStyle = '#333';
  ctx.beginPath();
  ctx.moveTo(xyArray[0]-0.5,xyArray[1])
  ctx.lineTo(xyArray[2],xyArray[3])
  ctx.arcTo(xyArray[4],xyArray[5],xyArray[6],xyArray[7],xyArray[10])
  ctx.lineTo(xyArray[8],xyArray[9])
  ctx.closePath;
  ctx.strokeStyle = '#333';ctx.fillStyle = '#333';
  ctx.stroke();
  //ctx.fill();

  drawAxis()
}



function drawAxis(){
  ctx.beginPath()
  ctx.lineWidth = 0.25*vh;
  ctx.strokeStyle = '#ddd'
  ctx.moveTo(baseX,baseY)
  
  //stop at each marker
  var stop = baseX;
  for (var i=1;i<5;i++){
      stop = stop + (3*widthU)
      ctx.lineTo(stop-0.2*vw,baseY)
      ctx.stroke()
      start = stop + 0.2*vw
      ctx.moveTo(start,baseY)
  }
  //markers
  for (var i=0;i<5;i++){
    ctx.moveTo(baseX+(i*3*widthU)-(0.31*0.4*vw/2),baseY-(0.95*0.4*vw))
    ctx.lineTo(baseX+(i*3*widthU),baseY);ctx.stroke()
    ctx.moveTo(baseX+(i*3*widthU),baseY)
    ctx.lineTo(baseX+(i*3*widthU)+(0.31*0.4*vw/2),baseY+(0.95*0.4*vw));ctx.stroke();  
  }
  
  //label
  ctx.font = 1.5*vw+ "px Arial";
  ctx.fillStyle = "#ccc";ctx.textAlign = "right";
  ctx.fillText("class of", baseX, baseY+2*vw);ctx.fillText("recommendation", baseX, baseY+3.2*vw);
  ctx.textAlign = "center";ctx.fillStyle="rgb(255,0,0)"
  ctx.fillText("III", baseX+3*widthU, baseY+2*vw);
  ctx.textAlign = "center";ctx.fillStyle="rgb(255,165,0)"
  ctx.fillText("IIb", baseX+6*widthU, baseY+2*vw);
  ctx.textAlign = "center";ctx.fillStyle="rgb(255,255,0)"
  ctx.fillText("IIa", baseX+9*widthU, baseY+2*vw);
  ctx.textAlign = "center";ctx.fillStyle="rgb(0,255,0)"
  ctx.fillText("I", baseX+12*widthU, baseY+2*vw);

  ctx.closePath();

}


function createCanvas() {
  const scale = window.devicePixelRatio;
  canvas.style.width = 0.9*window.innerWidth + 'px';
  canvas.style.height = 0.9*window.innerHeight + 'px';
  canvas.width = Math.floor(0.9*window.innerWidth * scale*2)
  canvas.height = Math.floor(0.9*window.innerHeight * scale*2)
  ctx.scale(scale*2,scale*2)
}



</script>

</body>
</html>
