<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>yinYang</title>
<style>
    * {margin: 0;}
</style>
</head>
<body>
    <canvas id="canvas" style="background: radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 100%);"></canvas>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const vw = Math.round(window.innerWidth/100);
const vh = Math.round(window.innerHeight/100);
const fireColor = ['#801100','#b62203','#d73502','#fc6400','#ff7500','#FAC000'];
const iceColor = ['#3f7eb3','#6ba7cc','#aedbf0','#fafeff','#e2fcff','#cbf1fa'];

createCanvas(1);

const radius = 20*vw;
const centerX = 50*vw;
const centerY = 40*vh;

nav=0;
window.addEventListener("keydown", function(event) {
    event.preventDefault();
    if (event.keyCode===32) {
      nav++;  
      stepMove()
    }
})

//baseAnimation()
function stepMove(){
    if (nav==1){
        dysAutonomia(0.38,0.55,0.4,0);}
    if (nav==2){
        dysAutonomia(0.38,0.55,0.4,1);
    }
}


function baseAnimation(){
    //0.45-0.55
    const min = 0.45;
    const max = 0.55;
    const maxStep = 15;
    var gap = 0;
    var left = min;
    var fwd = 0.01;
    var step = 0;

    var fire = getFireGrd(2);
    var ice = getIceGrd(2);

    setInterval(() => {
        ctx.clearRect(0,0,100*vw,100*vh);
        drawLeft(left-gap,fire);
        drawRight(1-left-gap,ice);   
        left = left + fwd; 
        step++;

        if (left>max){
            left=max;
        }
        if (left<min){
            left=min;
        }
        if (step>maxStep){
            step = 0;
            if (left>=max){fwd = -0.01;}
            if (left<=min){fwd = 0.01;}
        }
    }, 200);

}

function dysAutonomia(maxL,maxR,minR,freeze){
    
    var fire = getFireGrd(2);
    var ice = getIceGrd(2);

    //step 0 -- together
    drawLeft(0.5,fire);
    drawRight(0.5,ice);

    //step 1 -- separated;
    var left = 0.5;var right = 0.5;
    var end = Math.max(0.5-maxL,0.5-maxR);
    var step1 = setInterval(() => {
        for (let index = 0; index <= end; index=index+0.01) {
        left = left - index;
        if (left<maxL){left=maxL};
        right = right + index;
        if (right>maxR){right=maxR}

        ctx.clearRect(0,0,100*vw,100*vh);
        drawLeft(left,fire);
        drawRight(right,ice);
      } 
    }, 200);
    clearInterval(step1);

    //step2
    //step2 -- animated ice
    var step = 0;var maxStep = 10+(maxR-minR)*10;var fwd = 0.01;
    var right = maxR+step;var left = maxL;
    var count = 0;
    var step2 = setInterval(function(){
        animateIce();count++;
        if (count==20){
        console.log(count)
        clearInterval(step2);
    }
        },100)


    function animateIce(){
            ctx.clearRect(0,0,100*vw,100*vh);
            right = right + fwd;
            step++;
            if (right<minR){
                right = minR;left = left+0.01}
            if (right>maxR){
                right = maxR;left = left-0.01};
            if (step>maxStep){
                step = 0;
                if (right>=maxR){fwd = -0.01;}
                if (right<=minR){fwd = 0.01;}
            }
            drawLeft(left,fire);
            drawRight(right,ice);

    }
}

function getFireGrd(hot){

    const fire = ctx.createLinearGradient(centerX,centerY+radius,centerX,centerY-radius);
    for (let index = 0; index < fireColor.length; index++) {
        var hotFactor = (hot + index)/10;
        if (hotFactor>1){hotFactor =1}
        fire.addColorStop(hotFactor, fireColor[index]);
    }
    return fire;
}

function getIceGrd(cold){
    const ice= ctx.createLinearGradient(centerX,centerY-radius,centerX,centerY+radius,);
    for (let index = 0; index < fireColor.length; index++) {
        var coldFactor = (cold + index)/10;
        if (coldFactor>1){coldFactor =1}
        ice.addColorStop(coldFactor, iceColor[index]);
    }
    return ice;
}

function drawLeft(ratio,color){
    //arc left
    ctx.beginPath();
    ctx.arc(centerX,centerY+(radius*(1-ratio)),radius*ratio, 1.5*Math.PI, 0.5*Math.PI);
    ctx.arc(centerX,centerY, radius, 0.5 * Math.PI, 1.5 * Math.PI);
    ctx.arc(centerX,centerY-(radius*ratio),radius*(1-ratio), 1.5*Math.PI, 0.5*Math.PI,true);
    ctx.fillStyle = color;
    ctx.fill();
    ctx.closePath();
}

function drawRight(ratio,color){
    //arc right
    ctx.beginPath();
    ctx.arc(centerX,centerY-(radius*(1-ratio)),radius*ratio,0.5*Math.PI,1.5*Math.PI);
    ctx.arc(centerX,centerY,radius, 1.5*Math.PI,0.5*Math.PI);
    ctx.arc(centerX,centerY+(radius*ratio),radius*(1-ratio),0.5*Math.PI,1.5*Math.PI,true);
    ctx.fillStyle = color;
    ctx.fill();
    ctx.closePath()
}

 function createCanvas(mag) {
  const scale = window.devicePixelRatio;
  canvas.style.width = window.innerWidth + 'px';
  canvas.style.height = window.innerHeight + 'px';
  canvas.width = Math.floor(window.innerWidth * scale*mag)
  canvas.height = Math.floor(window.innerHeight * scale*mag)
  ctx.scale(scale*mag,scale*mag)
}
</script>
    
</body>
</html>