<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>calendar</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Rubik&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/2c3e1e841c.js" crossorigin="anonymous"></script>
</head>
<style>
    * {color: #ddd;font-family: 'Rubik', sans-serif;box-sizing: border-box;}
    button {border-radius: 0.5vw;padding: 0.5vw;cursor: pointer;}
    #cTable {font-size: 2.5vmax;padding: 1vw;border-collapse: collapse;text-align: center;
        margin-left: auto;margin-right: auto;margin-top: 1vh;}
    #cTable td {border: solid 0.2vw #797979;padding: 1vw;width: 11vw;}
    #nav {margin-top: 8vh;}
    #nav, #nav button {font-size: 2.2vmax;vertical-align: middle;}
    .cNav, #dateInput {cursor: pointer;}
    .cNav {padding: 0 2vw;}
    .cNav i {vertical-align: bottom;}
    #calendar {display: none;width: fit-content;margin-left: auto;margin-right: auto;}
    #dayLabel td {color:aquamarine;font-weight: 700;}
    #sum {display: none;z-index: 10;left: 20%;top: 10%;position: fixed;width: 60%;height: fit-content;color: #333;
    background-color: #ddd;padding:10%}
    #nameSum, #start, #end {color: crimson;background-color: #ddd;}
    #scheduling {display: none;}
    .line {text-align: center;}
    #user {display: none;border: #555 solid 0.1vmax;background-color: #ddd;padding:1vmax;
        color: #333;margin-top: 2vh;}
    #user label {font-size: 2vmax;background-color: inherit;color: inherit;}
    #user input {padding: 0.5vw;border-radius: 0.5vw;border: #797979 solid 0.1vmax;}

    #dayTable {display:block;overflow-y: scroll;border: #bbb 1px solid;width: 88vw;margin-left: auto;margin-right: auto;
        position: relative;border-collapse: collapse;}
    #header {position: sticky;top:0;z-index:1;background-color: aquamarine;}
    #header th {font-size: 2vmax;color: #333;cursor: pointer;}
    #dateCol, #roomCol {cursor: pointer;}
    .dateMenu,.roomMenu {position: absolute;background-color: #232323;padding: 0;margin: 0;list-style-type: none;
    box-shadow: 2px 4px 4px 4px rgba(100,100,100,0.5);overflow-y: scroll;overflow-x: hidden;text-overflow: ellipsis;}
    .dateList, .roomList {border-bottom: 1px #555 solid;font-size: 2vmax;
        padding: 3vh 0;}
    .dateList:hover, .roomList:hover {background-color: black;}
    .timeLine {text-align: right;vertical-align: top;padding: 0;margin: 0;}
    .timeLineCell1 {border-top:solid 0.1px #555;padding: 0;margin: 0;vertical-align: top;}
    .lineDiv {height: 1px;background-color:  #555;margin: 0;padding: 0;}
    #popUp {position: fixed;visibility: hidden;width: 98vw;height: 98vh;top:1vh;left:1vw;
        background-color:rgba(0,0,0,0.85);color: #ddd;font-size: 2.2vmax;padding: 2vmax 5vmax;z-index: 3;line-height: 150%;}
    #popUp label {color: aquamarine;}
    #popUp select, #popUp input {cursor: pointer;}
    #popUpDate, #popUpRoom {background-color:rgba(0,0,0,0.85);color: #ddd;font-size: 2vmax;padding: 0.1vmax;}
    #popUpTime, #endTime {background-color: #bbb;color: #333;font-size: 2vmax;padding: 0.1vw;}
    #closePopUp {position: absolute;top: 1vh;right: 1vw;color: #aaa;background-color: rgba(50,50,50,0.5);
        font-size: 2vmax;cursor: pointer;border-radius: 0.5vmax;padding: 0.2vmax 0.8vmax;}
    #sDetail {padding: 1vmax;border: #555 solid 0.2vmax;margin-top: 1vh;max-height: 50vh;overflow-y: scroll;}
    #sDetail textarea {background-color: #eee;color: #333;font-size: 2vmax;padding: 0.1vw;cursor: text;
        width: 100%;height: 5vmax;}
    #sDetail textarea:focus {background-color: white;}
    #sDetail select, #sDetail label, #sDetail option {background-color:rgba(0,0,0,0.85);color: #ddd;font-size: 1.8vmax;padding: 0.1vmax;}
    #sDetail label {color: aquamarine;padding: 1vmax;}
    .popUpBr {padding-top: 1vmax;} 
    .topicBar {position:relative;left: 0;border: pink solid 0.2vmax;font-size: 2.5vh;}

    /*mainmenu*/
    #menuIcon {position:fixed;cursor: pointer;z-index: 2;background-color: rgba(50,50,50,0.9);}
    #menuIcon i {width:4vmax;text-align: center;padding:0.6vmax 0.8vmax;font-size:2.2vmax;background-color: #232323;z-index: 10;}
    #mainMenu {display: none;height: 80vh;padding-right: 1vmax;animation: rollDown 0.4s;}
    #xMark {display: none;}
    #mainMenu div {margin-top: 1vh;background-color: #232323;padding-right: 1vmax;text-align: left;}
    #mainMenu i {width:5vmax;padding:0.6vmax 0.8vmax;font-size:2.2vmax;background-color: #232323;z-index: 10;color: aquamarine;
    border-right: #333 solid 1vmax;animation: fadeIn 1.2s;}
    #mainMenu span {animation:fadeIn 1.2s}
    #selectionBar {padding:2vmax 0 0 0;font-size: 1.8vmax;}
    #selectionBar i {font-size: 2vmax;color: #8ef5d0;}
    #selectionBar button {border:none;background-color: #232323;color: #dffff4;}

    #people {display: none;font-size: 2vmax;width: 88vw;margin-left: auto;margin-right: auto;text-align: center;}
    #people button {background-color: #232323;font-size: 1.8vmax;border-radius: 0.5vmax;margin-top: 0.5vh;}
    #PpTable {display: block;height: 80vh;position: relative;width: fit-content;max-width: 88vw;overflow: scroll;
        margin-left: auto;margin-right: auto;text-align: center;}
    #PpTable, #PpTable th, #PpTable tr, #pPTable td {border: #bbb 1px solid;border-collapse: collapse;padding: 0.5vmax;}
    #PpTable th {color: aquamarine;padding: 0.5vmax;position: sticky;}
    #PpTable td {padding: 0.5vmax 1vmax;}
    .PpDel {color:#55a288;padding:0 0.5vmax;cursor: pointer;font-weight: 900;}
    .PpName {cursor: pointer;}
    .PpName:hover {background-color: black;}
    .PpForm {display: none;text-align: left;color: #232323;}
    
    @media screen and (max-width:821px) {  
        #popUp {padding: 1vmax;line-height: 180%;}
        .noMobile {display: none;}
        #sum {width: 90%;left: 5%;}
        #mainMenu {width: 95vw;}
        #selectionBar {display: none;}
        #people {width: 95vw;}
        #PpTable {max-width: 95vw;}
    }

    @keyframes rollDown {
        0% {height: 0;}
        100% {height: 80vh;}
    }
    @keyframes marginDown {
        0% {margin-top: 0;}
        100% {margin-top: 1vh;}
    }
    @keyframes fadeIn {
        0% {opacity: 0;}
        100% {opacity: 1;}
    }


</style>
<body style="background-color: #333;">

<div id="setUp">
    <div style="text-align: center;">
        <div style="font-size: 3vmax;padding: 2vmax;color: aquamarine;">Setup your new meeting</div>
        <label for="meetingName" style="color: #ddd;font-size: 2vmax;">Name of the meeting:</label>
        <input type="text" id="meetingName" name="meetingName" 
        style="padding: 0.5vw;border-radius: 0.5vw;color: #333;">

        <div id="dateInput" onclick="displayCalendar('calendar')" 
        style="font-size: 2vmax;padding: 2vmax;">
            <span style="border: #797979 0.1vw solid;padding: 0.2vw;border-radius: 0.5vw;">
                &#x1F4C5;
            <span id="startDate">Start On</span>&nbsp;-&nbsp;
            <span id="endDate">End On</span>&nbsp;
            </span>
        </div>

        <button onclick="reset()" style="background-color: #333;">
            Reset
        </button>
        <button onclick="submit()" style="background-color: #333;">
            Submit
        </button>
    </div>


    <!--choose the date-->
    <div id="calendar">
    <div id="nav">
        <button onclick="today()" style="vertical-align: middle;color: crimson;font-weight: bold;background-color: #333;">
            Today
        </button>
        <span id="month" style="padding-left: 1vw;"></span>
        <span id="year"></span>
        <span style="float:right;">
            <span class="cNav noMobile" onclick="yearNav(-1)"><i class="fa-solid fa-angles-left"></i></span>
            <span class="cNav" onclick="monthNav(-1)"><i class="fa-solid fa-angle-left"></i></span>
            <span class="cNav" onclick="monthNav(1)"><i class="fa-solid fa-angle-right"></i></span>
            <span class="cNav noMobile" onclick="yearNav(1)"><i class="fa-solid fa-angles-right"></i></span>
        </span>
    </div>
    <table id="cTable">
        <tr id="dayLabel">
            <td>Sun</td><td>Mon</td><td>Tue</td>
            <td>Wed</td><td>Thu</td><td>Fri</td><td>Sat</td>
        </tr>
        <tr>
            <td class="calendarCell"></td><td class="calendarCell"></td><td class="calendarCell"></td>
            <td class="calendarCell"></td><td class="calendarCell"></td><td class="calendarCell"></td><td class="calendarCell"></td>
        </tr>
        <tr>
            <td class="calendarCell"></td><td class="calendarCell"></td><td class="calendarCell"></td>
            <td class="calendarCell"></td><td class="calendarCell"></td><td class="calendarCell"></td><td class="calendarCell"></td>
        </tr>
        <tr>
            <td class="calendarCell"></td><td class="calendarCell"></td><td class="calendarCell"></td>
            <td class="calendarCell"></td><td class="calendarCell"></td><td class="calendarCell"></td><td class="calendarCell"></td>
        </tr>
        <tr>
            <td class="calendarCell"></td><td class="calendarCell"></td><td class="calendarCell"></td>
            <td class="calendarCell"></td><td class="calendarCell"></td><td class="calendarCell"></td><td class="calendarCell"></td>
        </tr>
        <tr>
            <td class="calendarCell"></td><td class="calendarCell"></td><td class="calendarCell"></td>
            <td class="calendarCell"></td><td class="calendarCell"></td><td class="calendarCell"></td><td class="calendarCell"></td>
        </tr>
        <tr>
            <td class="calendarCell"></td><td class="calendarCell"></td><td class="calendarCell"></td>
            <td class="calendarCell"></td><td class="calendarCell"></td><td class="calendarCell"></td><td class="calendarCell"></td>
        </tr>
    </table>
    </div>

    <!--summary-->
    <h3 id="sum">
        Your meeting name is <span id="nameSum"></span>.<br>
        Starting on: <br>
        <span id="start"></span><br>
        Until:<br>
        <span id="end"></span>

        <!--create user/login-->
        <div id="user">
            Please create a unique ID for your meeting.<br><br>
            <label for="username">ID: </label> 
            <input style="color: #333;" type="text" id="username" name="username"><br>
            <div style="background-color: #ddd;padding: 2vmax 0;">
                <button id="backAfter" style="color: #333;">Back</button>
                <button id="nextAfter" style="color: #333;">
                    Next
                </button>
            </div>
        </div>

        <div id="beforeLogin" style="background-color: #ddd;padding: 2vmax 0;">
            <button id="back" style="color: #333;">Back</button>
            <button id="next" style="color: #333;">Next</button>
        </div>
    </h3>
    
</div>

<!--scheduling-->
<div id="scheduling">
    <div id="menuIcon">
        <i id="hamburger" class="fa-solid fa-bars" onclick="showMainMenu()"></i>
        <a href="index.html">
        <div style="right: 0.9vmax;position: fixed;top: 0.9vmax;text-align: left;line-height: 100%;font-size: 1.2vmax;color: #55a288;
        border: #555 solid 0.1vmax;border-radius: 0.4vmax;padding: 0.2vmax;background-color: rgba(0,0,0,0.85);">
        MeetinG<br>&nbsp;&nbsp;&nbsp;MediuM</div></a>
        <i id="xMark" class="fa-solid fa-circle-xmark" onclick="showMainMenu('x')"></i>
        
        <div id="mainMenu">
            <div class="menuItem">
                <i class="fa-solid fa-circle-user"></i>
                <span id="menuUser">UserID</span>
            </div>
            <div class="menuItem">
                <i class="fa-regular fa-pen-to-square"></i>
                <span>Edit Meeting Name/Date</span>
            </div>
            <div class="menuItem" onclick="managePeople()">
                <i class="fa-solid fa-person-chalkboard"></i>
                <span>Edit Speakers/Moderators</span>
            </div>
            <div class="menuItem" onclick="managePeople('x')">
                <i class="fa-solid fa-plus"></i>
                <span>Add Program</span>
            </div>
            <div class="menuItem">
                <i class="fa-solid fa-list-check"></i>
                <span>Show Program Summary</span>
            </div>
        </div>
    </div>
    <div id="title" style="text-align: center;padding: 5vh 2vw;">
        <div id="meetingName" style="font-size: 4vmax;">
            <span id='mName' style="color:aquamarine;">Meeting Name</span> 
            <sup><i class="fa-regular fa-pen-to-square" style="font-size: 1.8vmax;cursor: pointer;"></i></sup>
        </div>
        <div id="meetingDate" style="font-size: 3vmax;color:aquamarine;">
            <span id='mDate' style="color:aquamarine;">Meeting Date</span>  
            <sup><i class="fa-regular fa-pen-to-square" style="font-size: 1.8vmax;cursor: pointer;"></i></sup>
        </div>
        <div id="selectionBar">
            <button onclick="managePeople()">
                <i class="fa-solid fa-person-chalkboard"></i><br>
                <span>Edit Speakers/Moderators</span>
            </button>
            <button onclick="managePeople('x')">
                <i class="fa-solid fa-plus"></i><br>
                <span>Add Program</span>
            </button>
            <button>
                <i class="fa-solid fa-list-check"></i><br>
                <span>Show Program Summary</span>
            </button>
        </div>
    </div>


    <table id="dayTable">
        <tr id="header">
            <th id="dateCol" onclick="showDateMenu()">DATE&nbsp;&bigtriangledown;</th>
            <th id="roomCol" onclick="showRoomMenu()">ROOM&nbsp;&bigtriangledown;</th>
        </tr>
    </table>

    <div id="people">
        <table id="PpTable">
            <tr>
                <th>No.</th>
                <th>Firstname</th>
                <th>Lastname</th>
                <th>Institution</th>
                <th>Tools</th>
            </tr>
            <tr>
                <td style="cursor: pointer;" onclick="PpInput('on')" title="add">+</td>
                <td><input name="fName" id="fName" class="PpForm"></td>
                <td><input name="lName" id="lName" class="PpForm"></td>
                <td><input name="inst" id="inst" class="PpForm"></td>
                <td>
                    <span class="PpForm" style="cursor: pointer;color: #55a288;padding-left: 1vmax;font-weight: 900;" title="save" onclick="PpInput('save')">&#128427;</span>
                    <span class="PpForm" style="cursor: pointer;color: #55a288;padding-left: 1vmax;font-weight: 900;" title="reset" onclick="PpInput('reset')">&#10226;</span>
                </td>
            </tr>
        </table>
    </div>

    <!--popUp-->
    <div id="popUp">
        <button id="closePopUp">X</button>
        <label for="popUpDate">Date: </label>
        <select id="popUpDate" name="date"></select>
        <div class="popUpBr"></div>
        <label for="popUpRoom">Room: </label>
        <select id="popUpRoom" name="room"></select>
        <div class="popUpBr"></div>
        <label for='popUpTime'>Start: </label>
        <input type="time" id="popUpTime" name="popUpTime" step="1800">
        <div class="popUpBr"></div>
        <label for="endTime">End: </label>
        <input type="time" id="endTime" name="endTime" step="1800"><span id="endTimeAlert"></span>

        <div class="popUpBr"></div>
        <div id="sDetail">
            
            <label for="title">Title: </label><br>
            <form id="titleForm" style="text-align: center;line-height: 100%;">
                <textarea id="titleArea" onfocus="this.value=''">
                    enter title here...
                </textarea>
                <input type="reset" style="color: #333;">
            </form>
            <div class="popUpBr"></div>
            <label for="speaker1">Speaker #1</label>
            <select id="speaker1" name="speaker1"></select>
            <div class="popUpBr"></div>
            <label for="speaker2">Speaker #2</label>
            <select id="speaker2" name="speaker2"></select>
            <div class="popUpBr"></div>
            <label for="speaker3">Speaker #3</label>
            <select id="speaker3" name="speaker3"></select>
            <br>
            <label for="speaker4">Speaker #4</label>
            <select id="speaker4" name="speaker4"></select>
            <div class="popUpBr"></div>
            <label for="mod1">Moderator #1</label>
            <select id="mod1" name="mod1"></select>
            <div class="popUpBr"></div>
            <label for="mod2">Moderator #2</label>
            <select id="mod2" name="mod2"></select>
            <div class="popUpBr"></div>
            <label for="mod3">Moderator #3</label>
            <select id="mod3" name="mod3"></select>
        </div>
        <button id="popUpSave" style="color: #333;">Save</button>
        <button id="popUpExit" style="color:#333">Exit</button>
    </div>

</div>

<!--foot-->
<div style="border-top: #555 solid 0.1vmax;margin:0;padding: 2vw 5vw;
color: #aaa;font-size: 1.8vmax;margin-top: 20vh;text-align: center;">
    &copy;&nbsp;&nbsp;CODINDG OF A KIND</span><br>
    <span style="color:#888;font-size: 1.6vmax;">design to your style &middot; write to your need</span>
</div>


<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="program.js"></script>
<script>
const monthLabel = ['January','February','March','April','May','June',
'July','August','September','October','November','December']
var nowMonth;
var nowYear;
var dateArray = []
var oneDay = 24*60*60*1000
var defaultDuration = 60;

//color
var beginDColor = 'darkgreen'
var endDColor = 'crimson'
var midDColor = '#555'
var thisMonthColor = '#efefef'
var nextMonthColor = '#555'
var todayColor = 'red'

//dayview
//set up screen viewpoint
vw = screen.width/100;vh = screen.height/100;
vmax = getVmax();

//major variables -- date/room/speakers/userID
var beginD;var endD;var mName;var userID;
var dates = []
var rooms = ['Room1','Add/Edit']
var currentDate;
var currentRoom = rooms[0];
//[fName][lName][inst]
var people = []

//checkCookie()
checkHistory();

//check cookie and proceed accordingly
function checkHistory(){
    const uID = sessionStorage.getItem("meetingMedium")
    //console.log(uID)
    if (uID==null){
        setUpDateArray(dateArray);
        //show today calendar
        const now = new Date()  
        clearCalendar()
        dateRun(now)
    }
    else {
        document.getElementById('setUp').style.display = 'none'
        document.getElementById('scheduling').style.display = 'block'

        //get meeting info
        supUrl = 'https://entgoevitfioaiavmrfb.supabase.co'
        supKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVudGdvZXZpdGZpb2FpYXZtcmZiIiwicm9sZSI6ImFub24iLCJpYXQiOjE2Nzk1MzA2MTcsImV4cCI6MTk5NTEwNjYxN30.3ZFVeca2n5G0A43pgnFXWhSIZ0WO9rn9wuyWOFVuRfY'
        const database = supabase.createClient(supUrl,supKey)
          
        //get data
        const fetchData = async () => {
            const feed = await database
                .from("index")
                .select()
                .eq ('username', uID)
            getData(feed)
            //console.log(feed)
        }
        fetchData()

        function getData(feed){
            var match = feed.data[0]
            //var beginD;var endD;var mName;var userID;
            userID = match.username;
            mName = match.meetingName;
            beginD = new Date(match.beginD);
            endD = new Date(match.endD);
            setupTable()
            window.scrollTo({top:0,left:0})
        }
    }
}

//speakers/moderator management
function managePeople(option){
    const dayTable = document.getElementById('dayTable')
    const pp = document.getElementById('people')

    dayTable.style.display = 'none'
    pp.style.display = 'block'

    supUrl = 'https://entgoevitfioaiavmrfb.supabase.co'
    supKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVudGdvZXZpdGZpb2FpYXZtcmZiIiwicm9sZSI6ImFub24iLCJpYXQiOjE2Nzk1MzA2MTcsImV4cCI6MTk5NTEwNjYxN30.3ZFVeca2n5G0A43pgnFXWhSIZ0WO9rn9wuyWOFVuRfY'
    const database = supabase.createClient(supUrl,supKey)

    if (option!='x'){
        //clear people
        while (people.length>0){
            people[0].pop()
        }

        //fetch people
        const fetchData = async () => {
        const feed = await database
                .from("people")
                .select()
                .eq ('username', userID)
            feedPeople(feed)
        }
        fetchData()

    var oFeed;//string
    function feedPeople(feed){
        oFeed = JSON.stringify(feed)
        for (let index = 0; index < feed.data.length; index++) {
            const array = feed.data[index];
            newPp = [
                [array.firstname],
                [array.lastname],
                [array.institution]
            ]
            people.push(newPp)
            console.log(people)
        }
        if (people.length>0){
            showPp()
        }
        }
    }

    else {
        dayTable.style.display = 'block'
        pp.style.display = 'none'
        //dayTable.rows[8].scrollIntoView();
        showMainMenu('x')
        
        //check if people was edited
        if (oFeed != JSON.stringify(people)){
            //delete old data first
            const delOldData = async () => {
                const oldData = await database
                .from("people")
                .delete()
                .eq('username', userID)
            }
            delOldData()

            //submit people//fName, lName, inst
            const sendData = async () => {
                for (let index = 0; index < people.length; index++) {
                    const feed = await database.from("people").insert({
                        username: userID,
                        firstname:people[index][0],
                        lastname:people[index][1],
                        institution:people[index][2],
                        combined:people[index][0]+people[index][1]+people[index][2]
                    })
                }
            }
            sendData()
        }
    }
    
    showMainMenu('x')
}

function PpInput(option){
    //option: on, save, reset
    const input = document.getElementsByClassName('PpForm')

    if (option=='on'){
        for (let index = 0; index < input.length; index++) {
            input[index].style.display = 'table-cell';
        }
    }

    if (option=='reset'){
        //fName, lName, inst or PpForm 1-3
        for (let index = 0; index < 3; index++) {
            input[index].value = ''            
            input[index].innerHTML = ''
        }
    }

    if (option=='save'){
        var newPp = [
            [document.getElementById('fName').value],
            [document.getElementById('lName').value],
            [document.getElementById('inst').value]
        ]
        people.push(newPp)
        for (let index = 0; index < input.length; index++) {
            input[index].style.display = 'none';
        }
        PpInput('reset')
        showPp()
    }
}

function showPp(){
    const table = document.getElementById('PpTable');
    const oldLength = people.length;
    console.log(people.length)
    //clear table first
    while (table.rows.length>2){
        table.deleteRow(2)
    }

    for (let i = 0; i < people.length; i++) {
        var row = document.createElement('tr')
        table.appendChild(row)
        
        for (let j=0;j<5;j++){
            var cell = document.createElement('td')
            row.appendChild(cell)
            if (j==0) {
                cell.innerHTML = i+1;
            } 
            if (j>=1 && j<4){
                cell.innerHTML = people[i][j-1]
                cell.classList.add('PpName')
                cell.title = 'click to edit'
                cell.onclick = function(){
                    editPp(i,j)
                }
            }
            if (j==4){
                cell.innerHTML = '&#128465;'
                cell.classList.add('PpDel')
                cell.title = 'delete'
                cell.onclick = function(){
                    table.deleteRow(i+2);
                    people.splice(i,1);
                    showPp()
                }
            }
        }
    }

    function editPp(i,col){
        //2 rows exist already (header and add)
        row = i+2;
        var thisCell = table.rows[row].cells[col]
        var oldValue = thisCell.innerHTML;
        
        if (thisCell.children.length==0){
            thisCell.innerHTML = ''
            var x = document.createElement("INPUT");
            thisCell.appendChild(x)
            x.style.color = "#555"
            x.setAttribute("type", "text");
            x.setAttribute("value", oldValue)
            
            //change col4 to save icon
            var col4 = table.rows[row].cells[4]
            col4.innerHTML = '&#128427;'
            col4.title = 'save'
            col4.onclick = function(){
                people[i][col-1] = x.value
                col4.innerHTML = '&#128465;'
                col4.title = 'delete'
                x.remove();
                showPp();
            }
        }
    }


}


function showMainMenu(option){
    var menu = document.getElementById('mainMenu')
    var hamburger = document.getElementById('hamburger')
    var close = document.getElementById('xMark')
    document.getElementById('menuUser').innerHTML = 'UserID: ' + userID

    if (option == 'x'){
        menu.style.display = 'none'
        hamburger.style.display = 'block'
        close.style.display = 'none'
    } else {
        menu.style.display = 'block'
        hamburger.style.display = 'none'
        close.style.display = 'block'
    }
}

//submitting setup page
function submit(){
    mName = document.getElementById('meetingName').value;
    if (mName==''){
        alert('Please enter the name of the meeting.')
    }
    else {
        if (beginD==null){
            alert('Please enter the start date.')
        } else {
            if (endD==null){
                alert('Please enter the end date.')
            }
            else {
                //summary
                sum = document.getElementById('sum')
                sum.style.display = 'block'
                document.getElementById('nameSum').innerHTML = mName;
                document.getElementById('start').innerHTML = beginD.toDateString();
                document.getElementById('end').innerHTML = endD.toDateString();
                document.getElementById('back').onclick = function(){
                    sum.style.display='none' }
                document.getElementById('next').onclick = function(){
                    document.getElementById('beforeLogin').style.display = 'none'
                    document.getElementById('user').style.display = 'block'
                    document.getElementById('backAfter').onclick = function(){
                        sum.style.display='none' }
                        document.getElementById('nextAfter').onclick = function(){
                            var uName = document.getElementById('username').value;
                            if (uName ==''){
                                alert('please enter username')
                            } 
                            else {
                                //submit username, meetingName, beginD, endD
                                supUrl = 'https://entgoevitfioaiavmrfb.supabase.co'
                                supKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVudGdvZXZpdGZpb2FpYXZtcmZiIiwicm9sZSI6ImFub24iLCJpYXQiOjE2Nzk1MzA2MTcsImV4cCI6MTk5NTEwNjYxN30.3ZFVeca2n5G0A43pgnFXWhSIZ0WO9rn9wuyWOFVuRfY'
                                const database = supabase.createClient(supUrl,supKey)
                                //console.log (database)
                              
                                //sending data
                                const sendData = async () => {
                                    const feed = await database.from("index").insert({
                                        meetingName: mName, beginD:beginD, endD:endD,
                                        username: uName
                                    })

                                    if (Number(feed.status) <300){
                                        //console.log(feed.status)
                                        document.getElementById('setUp').style.display = 'none'
                                        document.getElementById('scheduling').style.display = 'block'
                                        setupTable()
                                        window.scrollTo({top:0,left:0})
                                        sessionStorage.setItem("meetingMedium",uName)
                                        userID = uName;

                                        //alert(document.cookie)
                                    }
                                    if (feed.status=='409'){
                                        alert('This ID has been taken.')
                                    }
                               
                                }
                                sendData();
                              }  
                            }
                        }
                    
                }
            }
        }
    }



function setUpDateArray(array){
    //total dateCell = 42
    for (let index = 0; index < 42; index++) {
        array[index]=""        
    }
}


function displayCalendar(id){
    document.getElementById(id).style.display = 'block'

}


function reset(){
    clearCalendar()
    var newDate = new Date(nowYear, nowMonth)
    beginD=null;endD=null;
    dateRun(newDate)
    document.getElementById('startDate').innerHTML = 'Start On'
    document.getElementById('endDate').innerHTML = 'End On'
    document.getElementById('meetingName').value =""
}


function today(){
    clearCalendar()
    dateRun(now)
}

function monthNav(nav){
    nowMonth = nowMonth + nav;
    var newDate = new Date(nowYear, nowMonth)
    clearCalendar()
    //console.log(newDate)
    dateRun(newDate)
}

function yearNav(nav){
    nowYear = nowYear + nav
    let newDate = new Date(nowYear, nowMonth)
    clearCalendar()
    dateRun(newDate)
}

function clearCalendar(){
    setUpDateArray(dateArray);
    var dateCell = document.getElementsByClassName('calendarCell')
    for (let index = 0; index < dateCell.length; index++) {
        dateCell[index].innerHTML = dateArray[index]    
    }
}

function dateRun(d){
    var dateCell = document.getElementsByClassName('calendarCell')
    
    //find the starting column
    const year = d.getFullYear();
    const month = d.getMonth();
    nowYear = year;nowMonth = month;
    document.getElementById('month').innerHTML = monthLabel[month]
    document.getElementById('year').innerHTML = year
    const firstDay = new Date(year, month, 1)
    const firstCol = firstDay.getDay();
    const today = new Date()
        
    for (let index = 0; index <(42-firstCol); index++) {
        var mSec = Date.parse(firstDay)+(oneDay*index)
        var indexDate = new Date(mSec)
   
        //check if month is over
        if (indexDate.getMonth()==month){
            dateCell[index+firstCol].style.color = thisMonthColor
            dateCell[index+firstCol].style.background = 'none'
            dateCell[index+firstCol].style.fontWeight = 'normal'
            dateCell[index+firstCol].innerHTML = indexDate.getDate();
            dateArray[index+firstCol]=indexDate;
            dateCell[index+firstCol].style.cursor = 'pointer'
            dateCell[index+firstCol].onclick = function(){setMeetingDate(index+firstCol)}

            //color today
            if (today.getFullYear()==year && today.getMonth()==month && today.getDate()==indexDate.getDate()){
                dateCell[index+firstCol].style.color = todayColor
                dateCell[index+firstCol].style.background = 'none'
                dateCell[index+firstCol].style.fontWeight = 'bold'
            }
              
        }
        else {
            //fill up next month
            dateCell[index+firstCol].innerHTML = indexDate.getDate(); 
            dateArray[index+firstCol]=indexDate;
            dateCell[index+firstCol].onclick = function(){setMeetingDate(index+firstCol)}
            //color next month
            dateCell[index+firstCol].style.color = nextMonthColor
            dateCell[index+firstCol].style.background = 'none'                       
            dateCell[index+firstCol].style.cursor = 'pointer'
        }
    }
    
    //fill up previous month
    if (firstCol>0){
        for (let index = 0; index < firstCol; index++) {
            var mSec = Date.parse(firstDay)-(oneDay*(firstCol-index))
            var indexDate = new Date(mSec)
            dateArray[index]=indexDate;
            dateCell[index].innerHTML = indexDate.getDate(); 
            dateCell[index].style.color = nextMonthColor
            dateCell[index].style.background = 'none'
            dateCell[index].style.cursor = 'pointer'
            dateCell[index].onclick = function(){setMeetingDate(index)}
        }
    }
    
    //color meeting date
    if (beginD!=null)
        {colorCell(beginD,beginDColor)}
    if (endD!=null)
        {colorCell(endD,endDColor)}
    if (beginD!=null && endD!=null){
        var dateDiff = (endD-beginD)/oneDay
        for (let index = 1; index < dateDiff; index++) {
            var newDate = new Date(Date.parse(beginD)+(index*oneDay))
            colorCell(newDate,midDColor)}
    }

}

function setMeetingDate(arrayIndex){
    var showStartDate = document.getElementById('startDate')
    var showEndDate = document.getElementById('endDate')
    var dateCell = document.getElementsByClassName('calendarCell')
    var dateClickmSec = Date.parse(dateArray[arrayIndex]);
    

    //start Date
    if (beginD==null && endD==null){
        beginD = dateArray[arrayIndex]
        colorCell(beginD,beginDColor)
        showStartDate.innerHTML = beginD.toDateString();
    }

    //endDate
    if (beginD!=null && dateArray[arrayIndex]>beginD){
        
        //expand meeting duration
        if (endD==null || dateArray[arrayIndex]>endD){
        endD = dateArray[arrayIndex]
        //dateCell[arrayIndex].style.background = 'green'
        colorCell(endD,endDColor)
        showEndDate.innerHTML = endD.toDateString();
        
        //in between
        var dateDiff = (endD-beginD)/oneDay
        //console.log(dateDiff)
        for (let index = 1; index < dateDiff; index++) {
            var newDate = new Date(Date.parse(endD)-(index*oneDay))
            colorCell(newDate,midDColor)
        }
        }

        //reduce meeting duration
        if (dateArray[arrayIndex]<endD){
            var dateRed = (endD-dateArray[arrayIndex])/oneDay
            for (let index = 1; index < dateRed; index++) {
                var clearDate = new Date(endD-(index*oneDay))
                clearCell(clearDate)           
            }
            clearCell(endD)
            endD = dateArray[arrayIndex]
            showEndDate.innerHTML = endD.toDateString();
            dateCell[arrayIndex].style.background = endDColor
        }
    }

    //new beginD
    if (beginD!=null && dateArray[arrayIndex]<beginD){
        clearCell(beginD)
        beginD = dateArray[arrayIndex]
        dateCell[arrayIndex].style.background = beginDColor
        showStartDate.innerHTML = beginD.toDateString();
        //in between
        var dateDiff = (endD-beginD)/oneDay
        for (let index = 1; index < dateDiff; index++) {
            var newDate = new Date(Date.parse(beginD)+(index*oneDay))
            colorCell(newDate,midDColor)
        }
    }
}

function clearCell(d){
    var dateCell = document.getElementsByClassName('calendarCell')
    var clearMonth = d.getMonth();
    var clearYear = d.getFullYear();
    var clearDate = d.getDate();
    for (let index = 0; index < dateArray.length; index++) {
        var cell = dateArray[index]
        //console.log(cell)
        if (d.getFullYear() == cell.getFullYear() && 
        d.getMonth() == cell.getMonth() &&
        d.getDate() == cell.getDate())
        {
            dateCell[index].style.color = thisMonthColor
            dateCell[index].style.background = 'none'
            dateCell[index].style.fontWeight = 'normal'
        }
        
    }
}

function colorCell(d,color){
    var dateCell = document.getElementsByClassName('calendarCell')
    var colorCell = d.getMonth();
    var colorYear = d.getFullYear();
    var colorDate = d.getDate();
    for (let index = 0; index < dateArray.length; index++) {
        var cell = dateArray[index]
        //console.log(cell)
        if (d.getFullYear() == cell.getFullYear() && 
        d.getMonth() == cell.getMonth() &&
        d.getDate() == cell.getDate())
        {
            dateCell[index].style.background = color
        }
        
    }
}

function showRoomMenu(){
    const table = document.getElementById('dayTable')
    const head = document.getElementById('roomCol')
    const top = head.offsetTop + 10*vh;
    const left = head.offsetLeft + 0.5*vw;
    const width = head.offsetWidth - vw;

    //to show menu or not
    const menu = document.getElementsByClassName('roomMenu')
    const list = document.getElementsByClassName('roomList')

    if (menu.length==0){
        const newList = document.createElement('div')
        head.appendChild(newList)
        newList.className = 'roomMenu'
        newList.style.visibility = 'visible'
        const oneHour = 9*vh;
        menu[0].style.maxHeight = 5*oneHour + 'px'

        //get coordinate
        newList.style.top = top + 'px';newList.style.left = left + 'px'
        newList.style.width = width+'px'
        }
    else {
        if (menu[0].style.visibility =='visible'){
            menu[0].style.visibility = 'hidden'
        } 
        else {
            menu[0].style.visibility = 'visible'}
    }

    //hide other menu
    showMainMenu('x')
    const otherM = document.getElementsByClassName('dateMenu');
    if (otherM.length>0){
        if (otherM[0].style.visibility=='visible'){
        otherM[0].style.visibility = 'hidden'
        }
    }

 
    //to add items or not
    if (rooms.length>list.length){
        var diff = rooms.length - list.length;
        var start = (rooms.length - diff)-1;

        for (let index = start+1; index < rooms.length; index++) {
            const newLi = document.createElement('li')
            menu[0].appendChild(newLi)
            newLi.style.width = width + 'px';
            newLi.className = 'roomList'
            //format date
            newLi.innerHTML = rooms[index]
        }
    }


    //date click
    for (let index = 0; index < list.length; index++) {
        list[index].onclick = function(){
            head.innerHTML = rooms[index]+' '+ '&#9661;';
            currentRoom = rooms[index]
            showRoomMenu();
        }
    }
}

function showDateMenu(){
    const table = document.getElementById('dayTable')
    const head = document.getElementById('dateCol')
    const top = head.offsetTop + 10*vh;
    const left = head.offsetLeft + 0.5*vw;
    const width = head.offsetWidth - vw;

    //to show menu or not
    const menu = document.getElementsByClassName('dateMenu')
    const list = document.getElementsByClassName('dateList')
    

    if (menu.length==0){
        const newList = document.createElement('div')
        head.appendChild(newList)
        newList.className = 'dateMenu'
        newList.style.visibility = 'visible'
        const oneHour = 9*vh;
        menu[0].style.maxHeight = 5*oneHour + 'px'

        //get coordinate
        newList.style.top = top + 'px';newList.style.left = left + 'px'
        newList.style.width = width+'px'
        }
    else {
        if (menu[0].style.visibility =='visible'){
            menu[0].style.visibility = 'hidden'
        } 
        else {
            menu[0].style.visibility = 'visible'}
    }

    //hide other menu
    showMainMenu('x')
    const otherM = document.getElementsByClassName('roomMenu');
    if (otherM.length>0){
        if (otherM[0].style.visibility=='visible'){
        otherM[0].style.visibility = 'hidden'
        }
    }
 
    //to add items or not
    if (dates.length>list.length){
        var diff = dates.length - list.length;
        var start = (dates.length - diff)-1;

        for (let index = start+1; index < dates.length; index++) {
            const newLi = document.createElement('li')
            menu[0].appendChild(newLi)
            newLi.style.width = width + 'px';
            newLi.className = 'dateList'
            //format date
            var date2Show = dates[index].toLocaleDateString("en-GB",{year: "2-digit",month:"short",day:"numeric"});
            newLi.innerHTML = date2Show
        }
    }


    //date click
    for (let index = 0; index < list.length; index++) {
        list[index].onclick = function(){
            const date2Show = dates[index].toLocaleDateString("en-GB",{year: "2-digit",month:"short",day:"numeric"});
            head.innerHTML = date2Show + ' '+ '&#9661;';
            currentDate = dates[index]
            showDateMenu();
        }
    }
}


function setupTable(){
    //meeting name and date
    document.getElementById('mName').innerHTML = mName;
    document.getElementById('mDate').innerHTML =  beginD.toLocaleDateString("en-GB",{year: "2-digit",month:"short",day:"numeric"}) + '  -  ' +
    endD.toLocaleDateString("en-GB",{year: "2-digit",month:"short",day:"numeric"})

    //date and room array
    var dateDiff = (endD-beginD)/oneDay
    for (let index = 0; index <= dateDiff; index++) {
        var newDate = new Date(Date.parse(beginD)+(index*oneDay))
        //console.log(newDate)
        dates.push(newDate)
    }
    currentDate = dates[0]
    
    //one hour equal to 3vh + header of 9vh
    const oneHour = 9*vh;
    
    //table will show only 8 hour; overflow --scroll
    const dayTable = document.getElementById('dayTable');
    dayTable.style.height = (9*oneHour) + 9*vh + 'px';
    //header height and width
    const head = document.getElementById('header')
    head.style.height = 9*vh + 'px';
    //console.log(dayTable.rows[0].cells.length)
    const colPad = 1*vmax;
    dateColW = 2*vw*9 + colPad;
    dayTable.rows[0].cells[0].style.width = dateColW + 'px';
    dayTable.rows[0].cells[1].style.width = 90*vw - dateColW + 'px'
    
    //create 24hr row
    for (let index = 0; index < 24; index++) {
        const newRow = document.createElement('tr')
        dayTable.appendChild(newRow)
        newRow.style.cursor = 'pointer'
        newRow.onmouseover = function(){
            newRow.cells[1].style.backgroundColor = 'rgba(220,20,60,0.5)'

        }
        newRow.onmouseleave = function(){
            for (let index = 1; index < dayTable.rows.length; index++) {
                dayTable.rows[index].cells[1].style.backgroundColor = 'initial'                
            }
        }
        newRow.onclick = function(){
            //clear all rows bg
            for (let index = 1; index < dayTable.rows.length; index++) {
                dayTable.rows[index].cells[1].style.backgroundColor = 'initial'                
            }
            currentDate.setHours(index)
            //alert(currentDate)
            //  newRow.cells[1].style.backgroundColor = 'crimson'
            programEnter(currentDate)
            //close mainMenu
            showMainMenu('x')
        }
        newRow.style.height = oneHour + 'px'
        const newCell0 = document.createElement('td')
        newRow.appendChild(newCell0)
        const newCell1 = document.createElement('td')
        newRow.appendChild(newCell1)
        var time2Show = index + ':00'
        newCell0.innerHTML = time2Show;
        newCell0.className = 'timeLine'
        newCell1.className = 'timeLineCell1'
        if (index==0){
            newCell1.style.border = 'none'
        }

    }

    dayTable.rows[8].scrollIntoView();
}

function programEnter(cDate){
    const pop = document.getElementById('popUp')
    pop.style.visibility = 'visible'

    //close popUp
    document.getElementById('closePopUp').onclick = function(){
        if (confirm('Close without save?')){
            pop.style.visibility = 'hidden'}
    }
    document.getElementById('popUpExit').onclick = function(){
        if (confirm('Close without save?')){
            pop.style.visibility = 'hidden'}
    }
    //date dropdown
    var d = document.getElementById('popUpDate')
    if (d.children.length<dates.length){
        for (let index = 0; index < dates.length; index++) {
            var opt = document.createElement('option')
            d.appendChild(opt)
            opt.value = dates[index]

            //preselected date that was clicked
            if (cDate==dates[index]){
                opt.setAttribute('selected', 'selected')
            }
            var date2Show = dates[index].toLocaleDateString("en-GB",{year: "2-digit",month:"short",day:"numeric"})
            opt.innerHTML = date2Show;
            opt.style.backgroundColor = 'rgba(0,0,0,0.85)'
        }
    }

    //room
    var r = document.getElementById('popUpRoom')
    if (r.children.length<rooms.length){
        for (let index = 0; index < rooms.length; index++) {
            var opt = document.createElement('option')
            r.appendChild(opt)
            opt.value = rooms[index]

            //preselected room that was clicked
            if (currentRoom==rooms[index]){
                opt.setAttribute('selected', 'selected')
            }
            opt.innerHTML = rooms[index];
            opt.style.backgroundColor = 'rgba(0,0,0,0.85)'
        }
    }

    //time
    var time2Show = cDate.toLocaleTimeString([],{hour: "2-digit", minute: "2-digit",hour12:false })
    var start = document.getElementById('popUpTime')
    start.value = time2Show;
    cDate.setMinutes(cDate.getMinutes() + defaultDuration);
    var end = document.getElementById('endTime')
    var endTime = cDate.toLocaleTimeString([],{hour: "2-digit", minute: "2-digit",hour12:false })
    end.value = endTime;
    var timeAlert = document.getElementById('endTimeAlert')

    //endTime has to be more than startTime
    start.onchange = function(){
        var startHour = Number(start.value.slice(0,2))
        var startMin = Number(start.value.slice(3,5))
        var endHour = Number(end.value.slice(0,2))
        var endMin = Number(end.value.slice(3,5))
        const s = new Date()
        s.setHours(startHour,startMin)
        const e = new Date()
        e.setHours(endHour, endMin)
        if (e<=s){
            timeAlert.innerHTML = '&nbsp;'+ '&#9888;'
        }
        else {
            timeAlert.innerHTML = ''
        }
    }

    end.onchange = function(){
        var startHour = Number(start.value.slice(0,2))
        var startMin = Number(start.value.slice(3,5))
        var endHour = Number(end.value.slice(0,2))
        var endMin = Number(end.value.slice(3,5))
        const s = new Date()
        s.setHours(startHour,startMin)
        const e = new Date()
        e.setHours(endHour, endMin)
        if (e<=s){
            timeAlert.innerHTML = '&nbsp;'+ '&#9888;'
        }
        else {
            timeAlert.innerHTML = ''
        }
    }
 
    //reset title
    document.getElementById('titleForm').reset();

    //dropdown lists for speakers & moderators -- speaker1-4, mod1-3 
    var peopleList = ['speaker1', 'speaker2', 'speaker3', 'speaker4',
                        'mod1' , 'mod2', 'mod3'
                        ]
    
    //demo 20 speakers -- people array
    //for (let index = 0; index < 20; index++) {
        //people.push(index)
    //}
    
    //dropdown
    for (let i = 0; i < peopleList.length; i++) {
       var s = document.getElementById(peopleList[i])
        for (let j=0; j<people.length;j++){
            var opt = document.createElement('option')
            s.appendChild(opt)
            opt.value = people[j][0]+' '+ people[j][1]+' ('+people[j][2]+')'
            opt.innerHTML = people[j][0]+' '+ people[j][1]+' ('+people[j][2]+')'
        }
    }


    //save
    document.getElementById('popUpSave').onclick = function(){
    //info to save
    //popUpDate, popUpRoom, popUpTime, endTime, title, speaker1-4, mod1-3
    var save = {
        date:document.getElementById('popUpDate').value,
        room:document.getElementById('popUpRoom').value,
        startTime:document.getElementById('popUpTime').value,
        endTime:document.getElementById('endTime').value,
        title:document.getElementById('titleArea').value,
        spk1:document.getElementById('speaker1').value,
        spk2:document.getElementById('speaker2').value,
        spk3:document.getElementById('speaker3').value,
        spk4:document.getElementById('speaker4').value,
        mod1:document.getElementById('mod1').value,
        mod2:document.getElementById('mod2').value,
        mod3:document.getElementById('mod3').value
    }

    //alert time then overlap
    if (timeAlert.innerHTML!=''){
        alert('End Time cannot be earlier than start time.')
        }
    else {
            if (isOverlap(save)){
                alert('You already have the program during this period in this room.')
            } else {
                addTopic(save)
                pop.style.visibility = 'hidden'
            }
    }
    }
}

function getVmax(){
    var vmax;
    if (vw>vh) {vmax = vw} else {vmax = vh}
    return vmax;
}





</script>

</body>
</html>