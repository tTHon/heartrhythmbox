<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>calendar</title>
</head>
<style>
    #cTable {font-size: 3vw;padding: 1vw;border-collapse: collapse;
        margin-left: auto;margin-right: auto;margin-top: 2vh;}
    #cTable td {border: solid 0.2vw #797979;padding: 1vw;width: 10vw;}

    .cNav, #dateInput {cursor: pointer;}
    #calendar {display: none;width: fit-content;margin-left: auto;margin-right: auto;}
    #sum {display: none;z-index: 10;left: 10%;top: 10%;position: fixed;width: 60%;height: 40%;
    background-color: #ddd;padding:10%}
    #nameSum, #start, #end {color: crimson;}
    #scheduling {display: none;}
    .line {text-align: center;}
</style>
<body style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">

<div id="setUp">
    <div style="text-align: center;">
        <h1>Setup your new meeting</h1>
        <label for="meetingName">Name of the meeting:</label>
        <input type="text" id="meetingName" name="meetingName">

        <h3 id="dateInput" onclick="displayCalendar('calendar')">
            <span style="border: #797979 0.1vw solid;padding: 0.2vw;">
                &#x1F4C5;
            <span id="startDate">Start On</span>&nbsp;-&nbsp;
            <span id="endDate">End On</span>&nbsp;
            </span>
        </h3>

        <button onclick="reset()">
            Reset
        </button>
        <button onclick="submit()">
            Submit
        </button>
    </div>


    <!--choose the date-->
    <div id="calendar">
    <h3>
        <button onclick="today()" style="vertical-align: middle;">
            Today
        </button>
        <span id="month"></span>
        <span id="year"></span>
        <span style="float:right">
            <span class="cNav" onclick="yearNav(-1)">&#8810;</span>
            <span class="cNav" onclick="monthNav(-1)">&lt;</span>
            <span class="cNav" onclick="monthNav(1)">&gt;</span>
            <span class="cNav" onclick="yearNav(1)">&#8811;</span>
        </span>
    </h3>
    <table id="cTable">
        <tr id="dayLabel">
            <td>Sun</td><td>Mon</td><td>Tue</td>
            <td>Wed</td><td>Thu</td><td>Fri</td><td>Sat</td>
        </tr>
        <tr>
            <td class="calendarCell"></td><td class="calendarCell"></td><td class="calendarCell"></td>
            <td class="calendarCell"></td><td class="calendarCell"></td><td class="calendarCell"></td><td class="calendarCell"></td>
        </tr>
        <tr>
            <td class="calendarCell"></td><td class="calendarCell"></td><td class="calendarCell"></td>
            <td class="calendarCell"></td><td class="calendarCell"></td><td class="calendarCell"></td><td class="calendarCell"></td>
        </tr>
        <tr>
            <td class="calendarCell"></td><td class="calendarCell"></td><td class="calendarCell"></td>
            <td class="calendarCell"></td><td class="calendarCell"></td><td class="calendarCell"></td><td class="calendarCell"></td>
        </tr>
        <tr>
            <td class="calendarCell"></td><td class="calendarCell"></td><td class="calendarCell"></td>
            <td class="calendarCell"></td><td class="calendarCell"></td><td class="calendarCell"></td><td class="calendarCell"></td>
        </tr>
        <tr>
            <td class="calendarCell"></td><td class="calendarCell"></td><td class="calendarCell"></td>
            <td class="calendarCell"></td><td class="calendarCell"></td><td class="calendarCell"></td><td class="calendarCell"></td>
        </tr>
        <tr>
            <td class="calendarCell"></td><td class="calendarCell"></td><td class="calendarCell"></td>
            <td class="calendarCell"></td><td class="calendarCell"></td><td class="calendarCell"></td><td class="calendarCell"></td>
        </tr>
    </table>
    </div>

    <!--summary-->
    <h3 id="sum">
        Your meeting is <span id="nameSum"></span>.<br>
        Starting on: 
        <span id="start"></span>
        Until: 
        <span id="end"></span>
        <div>
            <button id="back">Back</button>
            <button id="next">
                Next
            </button>
        </div>
    </h3>
</div>

<!--scheduling-->
<div id="scheduling">
    <div class="line"></div>
    <div class="line"></div>
</div>
<script>
const monthLabel = ['January','February','March','April','May','June',
'July','August','September','October','November','December']
var nowMonth;
var nowYear;
var beginD;var endD;
var dateArray = []
var oneDay = 24*60*60*1000

//color
var beginDColor = 'lightgreen'
var endDColor = 'pink'
var midDColor = 'lightgrey'

setUpDateArray(dateArray);

//show today calendar
const now = new Date()  
clearCalendar()
console.log(now)
dateRun(now)

//entering program
function program(name){
    pLine = document.getElementsByClassName('line')
    pLine[0].innerHTML = mName
    pLine[1].innerHTML = beginD.toDateString() + ' - ' + endD.toDateString();
}

//submitting setup page
function submit(){
    mName = document.getElementById('meetingName').value;
    if (mName==''){
        alert('Please enter the name of the meeting.')
    }
    else {
        if (beginD==null){
            alert('Please enter the start date.')
        } else {
            if (endD==null){
                alert('Please enter the end date.')
            }
            else {
                //summary
                sum = document.getElementById('sum')
                sum.style.display = 'block'
                document.getElementById('nameSum').innerHTML = mName;
                document.getElementById('start').innerHTML = beginD.toDateString();
                document.getElementById('end').innerHTML = endD.toDateString();
                document.getElementById('back').onclick = function(){
                    sum.style.display='none' }
                document.getElementById('next').onclick = function(){
                    //have to setup for data submission to supabase
                    //go to scheduling phase
                    document.getElementById('setUp').style.display = 'none'
                    document.getElementById('scheduling').style.display = 'block'
                    program(mName)
                }
            }
        }
    }
}


function setUpDateArray(array){
    //total dateCell = 42
    for (let index = 0; index < 42; index++) {
        array[index]=""        
    }
}


function displayCalendar(id){
    document.getElementById(id).style.display = 'block'

}


function reset(){
    clearCalendar()
    var newDate = new Date(nowYear, nowMonth)
    beginD=null;endD=null;
    dateRun(newDate)
    document.getElementById('startDate').innerHTML = 'Start On'
    document.getElementById('endDate').innerHTML = 'End On'
    document.getElementById('meetingName').value =""
}


function today(){
    clearCalendar()
    dateRun(now)
}

function monthNav(nav){
    nowMonth = nowMonth + nav;
    var newDate = new Date(nowYear, nowMonth)
    clearCalendar()
    //console.log(newDate)
    dateRun(newDate)
}

function yearNav(nav){
    nowYear = nowYear + nav
    let newDate = new Date(nowYear, nowMonth)
    clearCalendar()
    dateRun(newDate)
}

function clearCalendar(){
    setUpDateArray(dateArray);
    var dateCell = document.getElementsByClassName('calendarCell')
    for (let index = 0; index < dateCell.length; index++) {
        dateCell[index].innerHTML = dateArray[index]    
    }
}

function dateRun(d){
    var dateCell = document.getElementsByClassName('calendarCell')
    
    //find the starting column
    const year = d.getFullYear();
    const month = d.getMonth();
    nowYear = year;nowMonth = month;
    document.getElementById('month').innerHTML = monthLabel[month]
    document.getElementById('year').innerHTML = year
    const firstDay = new Date(year, month, 1)
    const firstCol = firstDay.getDay();
    const today = new Date()
        
    for (let index = 0; index <(42-firstCol); index++) {
        var mSec = Date.parse(firstDay)+(oneDay*index)
        var indexDate = new Date(mSec)
   
        //check if month is over
        if (indexDate.getMonth()==month){
            dateCell[index+firstCol].style.color = 'black'
            dateCell[index+firstCol].style.background = 'none'
            dateCell[index+firstCol].style.fontWeight = 'normal'
            dateCell[index+firstCol].innerHTML = indexDate.getDate();
            dateArray[index+firstCol]=indexDate;
            dateCell[index+firstCol].style.cursor = 'pointer'
            dateCell[index+firstCol].onclick = function(){setMeetingDate(index+firstCol)}

            //color today
            if (today.getFullYear()==year && today.getMonth()==month && today.getDate()==indexDate.getDate()){
                dateCell[index+firstCol].style.color = 'red'
                dateCell[index+firstCol].style.background = 'none'
                dateCell[index+firstCol].style.fontWeight = 'bold'
            }
              
        }
        else {
            //fill up next month
            dateCell[index+firstCol].innerHTML = indexDate.getDate(); 
            dateArray[index+firstCol]=indexDate;
            dateCell[index+firstCol].onclick = function(){setMeetingDate(index+firstCol)}
            //color next month
            dateCell[index+firstCol].style.color = '#ababab'
            dateCell[index+firstCol].style.background = 'none'                       
            dateCell[index+firstCol].style.cursor = 'pointer'
        }
    }
    
    //fill up previous month
    if (firstCol>0){
        for (let index = 0; index < firstCol; index++) {
            var mSec = Date.parse(firstDay)-(oneDay*(firstCol-index))
            var indexDate = new Date(mSec)
            dateArray[index]=indexDate;
            dateCell[index].innerHTML = indexDate.getDate(); 
            dateCell[index].style.color = '#ababab'
            dateCell[index].style.background = 'none'
            dateCell[index].style.cursor = 'pointer'
            dateCell[index].onclick = function(){setMeetingDate(index)}
        }
    }
    
    //color meeting date
    if (beginD!=null)
        {colorCell(beginD,beginDColor)}
    if (endD!=null)
        {colorCell(endD,endDColor)}
    if (beginD!=null && endD!=null){
        var dateDiff = (endD-beginD)/oneDay
        for (let index = 1; index < dateDiff; index++) {
            var newDate = new Date(Date.parse(beginD)+(index*oneDay))
            colorCell(newDate,midDColor)}
    }

}

function setMeetingDate(arrayIndex){
    var showStartDate = document.getElementById('startDate')
    var showEndDate = document.getElementById('endDate')
    var dateCell = document.getElementsByClassName('calendarCell')
    var dateClickmSec = Date.parse(dateArray[arrayIndex]);
    

    //start Date
    if (beginD==null && endD==null){
        beginD = dateArray[arrayIndex]
        //dateCell[arrayIndex].style.background = 'blue'
        colorCell(beginD,beginDColor)
        showStartDate.innerHTML = beginD.toDateString();
    }

    //endDate
    if (beginD!=null && dateArray[arrayIndex]>beginD){
        
        //expand meeting duration
        if (endD==null || dateArray[arrayIndex]>endD){
        endD = dateArray[arrayIndex]
        //dateCell[arrayIndex].style.background = 'green'
        colorCell(endD,endDColor)
        showEndDate.innerHTML = endD.toDateString();
        
        //in between
        var dateDiff = (endD-beginD)/oneDay
        //console.log(dateDiff)
        for (let index = 1; index < dateDiff; index++) {
            var newDate = new Date(Date.parse(endD)-(index*oneDay))
            colorCell(newDate,midDColor)
        }
        }

        //reduce meeting duration
        if (dateArray[arrayIndex]<endD){
            var dateRed = (endD-dateArray[arrayIndex])/oneDay
            for (let index = 1; index < dateRed; index++) {
                var clearDate = new Date(endD-(index*oneDay))
                clearCell(clearDate)           
            }
            clearCell(endD)
            endD = dateArray[arrayIndex]
            showEndDate.innerHTML = endD.toDateString();
            dateCell[arrayIndex].style.background = endDColor
        }
    }

    //new beginD
    if (beginD!=null && dateArray[arrayIndex]<beginD){
        clearCell(beginD)
        beginD = dateArray[arrayIndex]
        dateCell[arrayIndex].style.background = beginDColor
        showStartDate.innerHTML = beginD.toDateString();
        //in between
        var dateDiff = (endD-beginD)/oneDay
        for (let index = 1; index < dateDiff; index++) {
            var newDate = new Date(Date.parse(beginD)+(index*oneDay))
            colorCell(newDate,midDColor)
        }
    }
}

function clearCell(d){
    var dateCell = document.getElementsByClassName('calendarCell')
    var clearMonth = d.getMonth();
    var clearYear = d.getFullYear();
    var clearDate = d.getDate();
    for (let index = 0; index < dateArray.length; index++) {
        var cell = dateArray[index]
        //console.log(cell)
        if (d.getFullYear() == cell.getFullYear() && 
        d.getMonth() == cell.getMonth() &&
        d.getDate() == cell.getDate())
        {
            dateCell[index].style.color = 'black'
            dateCell[index].style.background = 'none'
            dateCell[index].style.fontWeight = 'normal'
        }
        
    }
}

function colorCell(d,color){
    var dateCell = document.getElementsByClassName('calendarCell')
    var colorCell = d.getMonth();
    var colorYear = d.getFullYear();
    var colorDate = d.getDate();
    for (let index = 0; index < dateArray.length; index++) {
        var cell = dateArray[index]
        //console.log(cell)
        if (d.getFullYear() == cell.getFullYear() && 
        d.getMonth() == cell.getMonth() &&
        d.getDate() == cell.getDate())
        {
            //dateCell[index].style.color = 'black'
            dateCell[index].style.background = color
            //dateCell[index].style.fontWeight = 'normal'
        }
        
    }
}



</script>

</body>
</html>