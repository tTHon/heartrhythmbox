<!DOCTYPE html>
<html>

<style>
/*color*/
.orange0 {background-color: #F7B022;}
.green0 {background-color: #23E068;}
.blue0 {background-color: #5ED7FF;}

</style>

<body>

<div id="demo"></div>
<button id="b1" onclick="refresh()">refresh</button>
<div style="text-align:center">
  <canvas id="canvas" style="border:0.1vw solid black;"></canvas>
</div>

<script src="fetchScore.js"></script>
<script>
var canvas = document.getElementById("canvas");
var ctx = canvas.getContext("2d");
var vw = window.innerWidth/100;
var vh = window.innerHeight/100;

//gauge box size 32vw x 50vh
var radius = 10*vw;var baseY = 30*vh;
var nav=0;

createCanvas()
drawFace(1);
drawFace(2);
drawFace(3);
drawHand(1,-120);
drawHand(2,-120);
drawHand(3,-120);
drawLabel(1);
drawLabel(2);
drawLabel(3);

//nav
window.addEventListener("keydown", function(event) {
    event.preventDefault();
    if (event.keyCode===32) {
      nextMove()
      }
})


function refresh(){
  reFetch(1);reFetch(2);reFetch(3)
}
;

function createCanvas() {
  const scale = window.devicePixelRatio;
  canvas.style.width = 0.96*window.innerWidth + 'px';
  canvas.style.height = 0.5*window.innerHeight + 'px';
  canvas.width = Math.floor(0.96*window.innerWidth * scale*2)
  canvas.height = Math.floor(0.5*window.innerHeight * scale*2)
  ctx.scale(scale*2,scale*2)
}

function nextMove(){
  nav++;
  if (nav==1){    
    //dropText('MRI is the test of choice.',60)
    moveHand(1,-120,-130)

  }
  if (nav==2){
    //dropText('Device is MRI-conditional.',50)
    moveHand(2,-120,-190)
    moveHand(3,-120,-420)
  }
}

function dropText(add,gNo){
  ctx.textAlign = "start";ctx.fillStyle = "#333";
  ctx.font = 2*vw + 'px Arial';
  var baseX = (16*vw*(2*gNo-1)); 
  endX = baseX;
  endY = 10*vh;
  //document.getElementById('demo').innerHTML = add
  ctx.fillText(add,endX,endY)
}

function drawLabel(gNo){
  var baseX = (16*vw*(2*gNo-1)); 
  //cos 62
  var xLeft=baseX-(Math.cos(Math.PI*55/180)*(radius));
  var xRight = baseX+(Math.cos(Math.PI*55/180)*(radius));
  var yPos = baseY+radius+0.5*vh;
  ctx.beginPath();
  ctx.fillStyle = "#444"
  var hand = 0.8*radius
  ctx.font = 'bold '+ 2*vw + 'px Arial'
  ctx.textAlign = "center";
  ctx.fillText ('0',xLeft,yPos) 
  ctx.fillText ('150',xRight,yPos) 
}

function drawFace(gNo) {
  var xPos=16*vw*(2*gNo-1);var yPos = baseY;

  //red
  ctx.beginPath();
  ctx.arc(xPos, yPos, radius, Math.PI*120/180, Math.PI*204/180);
  ctx.fillStyle = 'pink';
  ctx.lineTo(xPos, yPos)
  ctx.fill();

  //orange
  ctx.beginPath();
  ctx.arc(xPos, yPos, radius, Math.PI*205/180, 214/180*Math.PI);
  ctx.fillStyle = 'orange';
  ctx.lineTo(xPos, yPos)
  ctx.fill();

//yellow
ctx.beginPath();
  ctx.arc(xPos, yPos, radius, 215/180*Math.PI, 225/180*Math.PI);
  ctx.fillStyle = 'yellow';
  ctx.lineTo(xPos, yPos)
  ctx.fill();

//green
  ctx.beginPath();
  ctx.arc(xPos, yPos, radius, 225/180*Math.PI,420/180*Math.PI);
  ctx.fillStyle = 'green';
  ctx.lineTo(xPos, yPos)
  ctx.fill();

  //draw arc blank
  ctx.beginPath();
  ctx.arc(xPos, yPos, radius*0.6, 0, 2*Math.PI);
  ctx.fillStyle = 'white';
  ctx.fill();  

  //draw center
  ctx.beginPath();
  ctx.arc(xPos, yPos, radius*0.15, 0, 2*Math.PI);
  ctx.fillStyle = '#333';
  ctx.fill();


}

function drawHand(gNo,degree) {
    var length = 0.8*radius;
    var xPos=16*vw*(2*gNo-1);var yPos = baseY;
    ctx.beginPath();
    ctx.lineWidth = vw;
    ctx.lineCap = "round";
    xEnd = length*Math.cos(Math.PI*degree/180);
    yEnd = length*Math.sin(Math.PI*degree/180);
    ctx.moveTo(xPos,yPos);
    ctx.lineTo(xPos+xEnd,yPos-yEnd);
    ctx.strokeStyle = 'red'
    ctx.stroke();
}

function moveHand(gNo,degreeS,degreeEnd){

  //go2End+2
    var distance = (degreeEnd-degreeS)+5;
    var tEnd=1;
    var moveInterval=setInterval(function(){
      clearFace(gNo);
      drawFace(gNo);
      drawHand(gNo,degreeS+tEnd)
      tEnd++;
      if (tEnd>=distance){
      clearInterval(moveInterval)
      shakeMinus(gNo);
      shakePlus(gNo);
    }
    },30*tEnd/distance)

  
  
  //shake-2
  function shakeMinus(){
  var tBack=1;
  var shakeBack=setInterval(function(){
    clearFace(gNo);
    drawFace(gNo);
    drawHand(gNo,(degreeEnd+5)-tBack)
    drawLabel(gNo);
    tBack++;
    if (tBack>=10){
    clearInterval(shakeBack)
    }
  },tBack)
  }

  //shake+2
  function shakePlus(){
  var tFwd=1;
  var shakeFwd=setInterval(function(){
    clearFace(gNo);
    drawFace(gNo);
    drawHand(gNo,(degreeEnd-5)+tFwd)
    tFwd++;
    if (tFwd>=10){
    clearInterval(shakeFwd)
    clearFace(gNo);
    drawFace(gNo);
    drawHand(gNo,degreeEnd)
    }
  },tFwd*50)
  }

}

function clearFace(gNo){
  var xPos=16*vw*(2*gNo-1);var yPos = baseY;
  ctx.fillStyle = 'white';
  ctx.beginPath();
  ctx.arc(xPos, yPos, radius, 100/180*Math.PI,440/180*Math.PI);
  ctx.lineTo(xPos, yPos)
  ctx.fill();
}

</script>

</body>
</html>
